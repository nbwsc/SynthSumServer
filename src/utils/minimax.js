const request = require('axios');
const { api_key, group_id } = require('../config/apikeys').MinimaxKey;

async function chat(userName, message) {
    const url = `https://api.minimax.chat/v1/text/chatcompletion_pro?GroupId=${group_id}`;
    const data = {
        "model": "abab5.5-chat",
        "tokens_to_generate": 1024,
        temperature: 0.01,
        top_p: 0.1,
        stream: false,
        "reply_constraints": { "sender_type": "BOT", "sender_name": "CC助理" },
        "bot_setting": [
            {
                "bot_name": "CC助理",
                "content": "CC助理是大型语言模型。",
            }
        ],
        messages: [{ sender_type: 'USER', sender_name: userName, text: message }],
    };
    const r = await request({
        url,
        method: 'post',
        headers: {
            Authorization: `Bearer ${api_key}`,
            'Content-Type': 'application/json',
        },
        data,
    });
    if (r.data.base_resp.status_code === 0) {
        const reply = r.data.reply;
        return reply;
    } else {
        console.log(r.data);
        return 'API 请求失败，请稍后重试';
    }
}

async function answerWithInfo(question, info) {
    const res = await chat('用户', `以下是一篇论文摘要：
${info}
结合上述信息，回答问题，如果是一个“是否”问题，则仅回答“是”、“否”、“不确定”：
${question}
`)
    return res
}

async function summary(text) {
    const res = await chat('用户', `对以下是论文标题和摘要进行总结：
${text}
    `)
    return res
}

async function getPaperStudyInfo(text) {
    const res = await chat('用户', `以下是论文标题和摘要：
${text}

总结论文的以下特点：
实验人群、
样本数量、
实验方法（从以下选项中选择：随机对照试验、前后实验设计、独立测量设计、重复测量设计、因子设计、交叉设计、自然实验设计、固定效应模型、递归实验设计、其他方法）
实验结果`
    )
    return res
}

async function checkRelation(question, text) {
    const res = await chat('用户', `以下是一个问题和论文标题和摘要：
问题：${question}
论文标题和摘要：${text}

请用“高”,"低"来评价问题和论文标题和摘要的关联程度。
`)
    return res
}

module.exports = {
    chat,
    answerWithInfo,
    summary,
    getPaperStudyInfo,
    checkRelation
}
// answerWithInfo('肌酸有助于增强肌肉吗？', `肌酸、精氨酸 α-酮戊二酸、氨基酸和中链甘油三酯以及耐力和表现。
// 肌酸 (Cr) 补充剂可增加肌肉质量、力量和力量。精氨酸 α-酮戊二酸 (A-AKG) 是一氧化氮生成的前体，具有改善血液流动和肌肉营养输送（即 Cr）的潜力。这项研究比较了含 Cr、A-AKG、谷氨酰胺、牛磺酸、支链氨基酸和中链甘油三酯的商业膳食补充剂与单独的 Cr 或安慰剂对运动表现和身体成分的影响。35 名男性（约 23 岁）被随机分配至 Cr + A-AKG (0.1 g . kg(-1) . d(-1) Cr + 0.075 g . kg(-1) . d(-1)A- AKG，n = 12)、Cr (0.1 g . kg(-1) . d(-1)，n = 11) 或安慰剂 (1 g . kg(-1) . d(-1) 蔗糖，n = 12）持续10天。在补充之前和之后测量身体成分、肌肉耐力（卧推）以及峰值和平均功率（温盖特测试）。随着 Cr + A-AKG (30.9 +/- 6.6 +/- 34.9 +/- 8.7 次；p < .01) 和 Cr (27.6 +/- 5.9 +/- 31.0 +/-) 的增加，卧推重复次数超过 3 组7.6 次；p < .01），安慰剂没有变化（26.8 +/- 5.0 +/- 27.1 +/- 6.3 次）。Cr + A-AKG 的峰值功率显着增加 (741 +/- 112 +/- 794 +/- 92 W；p < .01)，而 Cr 没有变化 (722 +/- 138 +/- 730 +/- 144 W）和安慰剂（696 +/- 63 +/- 705 +/- 77 W）。随着时间的推移，各组之间的平均功率没有差异。只有仅含铬组的总体质量有所增加（79.9 +/- 13.0 +/- 81.1 +/- 13.8 kg；p < .01），而瘦组织或脂肪量没有显着变化。这些结果表明，单独使用 Cr 以及与 A-AKG 结合使用可提高上半身肌肉耐力，而 Cr + A-AKG 补充可提高重复温盖特测试中的峰值功率输出。`)

chat('test', `以下是论文标题和摘要：
肌酸、精氨酸 α-酮戊二酸、氨基酸和中链甘油三酯以及耐力和表现。
肌酸 (Cr) 补充剂可增加肌肉质量、力量和力量。精氨酸 α-酮戊二酸 (A-AKG) 是一氧化氮生成的前体，具有改善血液流动和肌肉营养输送\
（即 Cr）的潜力。这项研究比较了含 Cr、A-AKG、谷氨酰胺、牛磺酸、支链氨基酸和中链甘油三酯的商业膳食补充剂与单独的 Cr 或安慰剂对\
运动表现和身体成分的影响。35 名男性（约 23 岁）被随机分配至 Cr + A-AKG (0.1 g . kg(-1) . d(-1) Cr + 0.075 g . kg(-1) .\
 d(-1)A- AKG，n = 12)、Cr (0.1 g . kg(-1) . d(-1)，n = 11) 或安慰剂 (1 g . kg(-1) . d(-1) 蔗糖，n = 12）持续10天。\
在补充之前和之后测量身体成分、肌肉耐力（卧推）以及峰值和平均功率（温盖特测试）。随着 Cr + A-AKG (30.9 +/- 6.6 +/- 34.9 +/- 8.7 \
次；p < .01) 和 Cr (27.6 +/- 5.9 +/- 31.0 +/-) 的增加，卧推重复次数超过 3 组7.6 次；p < .01），安慰剂没有变化（26.8 +/- 5.0 +/- \
27.1 +/- 6.3 次）。Cr + A-AKG 的峰值功率显着增加 (741 +/- 112 +/- 794 +/- 92 W；p < .01)，而 Cr 没有变化 (722 +/- 138 +/- 730 \
+/- 144 W）和安慰剂（696 +/- 63 +/- 705 +/- 77 W）。随着时间的推移，各组之间的平均功率没有差异。只有仅含铬组的总体质量有所增加（79.9 +/\
- 13.0 +/- 81.1 +/- 13.8 kg；p < .01），而瘦组织或脂肪量没有显着变化。这些结果表明，单独使用 Cr 以及与 A-AKG 结合使用可提高上半身肌肉耐\
力，而 Cr + A-AKG 补充可提高重复温盖特测试中的峰值功率输出。
总结论文的以下特点：
实验人群、
样本数量、
实验方法（从以下选项中选择：随机对照试验、前后实验设计、独立测量设计、重复测量设计、因子设计、交叉设计、自然实验设计、固定效应模型、递归实验设计、其他方法）
实验结果`)

/**
 * 
 * 总结以下论文摘要：
肌酸、精氨酸 α-酮戊二酸、氨基酸和中链甘油三酯以及耐力和表现。
肌酸 (Cr) 补充剂可增加肌肉质量、力量和力量。精氨酸 α-酮戊二酸 (A-AKG) 是一氧化氮生成的前体，具有改善血液流动和肌肉营养输送（即 Cr）的潜力。这项研究比较了含 Cr、A-AKG、谷氨酰胺、牛磺酸、支链氨基酸和中链甘油三酯的商业膳食补充剂与单独的 Cr 或安慰剂对运动表现和身体成分的影响。35 名男性（约 23 岁）被随机分配至 Cr + A-AKG (0.1 g . kg(-1) . d(-1) Cr + 0.075 g . kg(-1) . d(-1)A- AKG，n = 12)、Cr (0.1 g . kg(-1) . d(-1)，n = 11) 或安慰剂 (1 g . kg(-1) . d(-1) 蔗糖，n = 12）持续10天。在补充之前和之后测量身体成分、肌肉耐力（卧推）以及峰值和平均功率（温盖特测试）。随着 Cr + A-AKG (30.9 +/- 6.6 +/- 34.9 +/- 8.7 次；p < .01) 和 Cr (27.6 +/- 5.9 +/- 31.0 +/-) 的增加，卧推重复次数超过 3 组7.6 次；p < .01），安慰剂没有变化（26.8 +/- 5.0 +/- 27.1 +/- 6.3 次）。Cr + A-AKG 的峰值功率显着增加 (741 +/- 112 +/- 794 +/- 92 W；p < .01)，而 Cr 没有变化 (722 +/- 138 +/- 730 +/- 144 W）和安慰剂（696 +/- 63 +/- 705 +/- 77 W）。随着时间的推移，各组之间的平均功率没有差异。只有仅含铬组的总体质量有所增加（79.9 +/- 13.0 +/- 81.1 +/- 13.8 kg；p < .01），而瘦组织或脂肪量没有显着变化。这些结果表明，单独使用 Cr 以及与 A-AKG 结合使用可提高上半身肌肉耐力，而 Cr + A-AKG 补充可提高重复温盖特测试中的峰值功率输出。`)

回答：
 * 这项研究比较了含肌酸 (Cr)、精氨酸 α-酮戊二酸 (A-AKG)、谷氨酰胺、牛磺酸、支链氨基酸和中链甘油三酯的商业膳食补充剂与单独的 Cr 
 * 或安慰剂对运动表现和身体成分的影响。结果发现，单独使用 Cr 以及与 A-AKG 结合使用可提高上半身肌肉耐力，而 Cr + A-AKG 补充可
 * 提高重复温盖特测试中的峰值功率输出。然而，只有仅含铬组的总体质量有所增加，而瘦组织或脂肪量没有显着变化。
 */

/**
 * 
 * 以下是论文标题和摘要：
肌酸、精氨酸 α-酮戊二酸、氨基酸和中链甘油三酯以及耐力和表现。
肌酸 (Cr) 补充剂可增加肌肉质量、力量和力量。精氨酸 α-酮戊二酸 (A-AKG) 是一氧化氮生成的前体，具有改善血液流动和肌肉营养输送\
（即 Cr）的潜力。这项研究比较了含 Cr、A-AKG、谷氨酰胺、牛磺酸、支链氨基酸和中链甘油三酯的商业膳食补充剂与单独的 Cr 或安慰剂对\
运动表现和身体成分的影响。35 名男性（约 23 岁）被随机分配至 Cr + A-AKG (0.1 g . kg(-1) . d(-1) Cr + 0.075 g . kg(-1) .\
 d(-1)A- AKG，n = 12)、Cr (0.1 g . kg(-1) . d(-1)，n = 11) 或安慰剂 (1 g . kg(-1) . d(-1) 蔗糖，n = 12）持续10天。\
在补充之前和之后测量身体成分、肌肉耐力（卧推）以及峰值和平均功率（温盖特测试）。随着 Cr + A-AKG (30.9 +/- 6.6 +/- 34.9 +/- 8.7 \
次；p < .01) 和 Cr (27.6 +/- 5.9 +/- 31.0 +/-) 的增加，卧推重复次数超过 3 组7.6 次；p < .01），安慰剂没有变化（26.8 +/- 5.0 +/- \
27.1 +/- 6.3 次）。Cr + A-AKG 的峰值功率显着增加 (741 +/- 112 +/- 794 +/- 92 W；p < .01)，而 Cr 没有变化 (722 +/- 138 +/- 730 \
+/- 144 W）和安慰剂（696 +/- 63 +/- 705 +/- 77 W）。随着时间的推移，各组之间的平均功率没有差异。只有仅含铬组的总体质量有所增加（79.9 +/\
- 13.0 +/- 81.1 +/- 13.8 kg；p < .01），而瘦组织或脂肪量没有显着变化。这些结果表明，单独使用 Cr 以及与 A-AKG 结合使用可提高上半身肌肉耐\
力，而 Cr + A-AKG 补充可提高重复温盖特测试中的峰值功率输出。
总结论文的以下特点：
实验人群、
样本数量、
实验方法（从以下选项中选择：随机对照试验、前后实验设计、独立测量设计、重复测量设计、因子设计、交叉设计、自然实验设计、固定效应模型、递归实验设计、其他方法）
实验结果
 * 
回答：
实验人群：35 名男性（约 23 岁）
样本数量：12 名受试者接受 Cr + A-AKG 补充，11 名受试者接受 Cr 补充，12 名受试者接受安慰剂。
实验方法：随机对照试验
实验结果：Cr + A-AKG 补充显著提高了卧推重复次数和峰值功率输出，而 Cr 补充仅提高了卧推重复次数。
总体质量在仅含铬组中增加，但瘦组织或脂肪量没有显著变化。
 */